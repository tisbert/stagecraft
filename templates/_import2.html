{% extends '_layouts/cp' %}

{% set title = 'Stagecraft - Import Preview' %}


{% set tabs = {
export: { label: "Export"|t, url: url('stagecraft') },
import: { label: "Import"|t, url: url('stagecraft/import') },
} %}

{% set selectedTab = 'import' %}

{% set crumbs = [
{ label: "Settings"|t, url: url('settings') },
{ label: "Plugins"|t, url: url('settings/plugins') },
{ label: "Stagecraft"|t, url: url('stagecraft') }
] %}

{% includeJsResource('stagecraft/js/default.js') %}
{% includeCssResource('stagecraft/css/default.css') %}

{% block content %}

  {% import '_includes/forms' as forms %}

  <div class="grid">

    <div class="item">
        <form method="POST" accept-charset="UTF-8">
          <input type="hidden" name="action" value="stagecraft/import/complete">

        {% if model.fields | length %}
          <h2>Fields to be imported</h2>
          <table class="data fullwidth">
            <thead>
              <tr>
                <th>Group/Field</th>
                <th>Type</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
            {% for key, group in model.fields %}
              <tr>
                <th colspan="2">{{ key }}</th>
                <td>{{ craft.Stagecraft.FieldGroupStatus(key) | raw }}</td>
              </tr>
              {% for fkey, field in group %}
                <tr>
                  <td>&nbsp;&nbsp;&nbsp;{{ fkey }}</td>
                  <td>{{  field.type }}</td>
                  <td>{{ craft.Stagecraft.FieldStatus(key, fkey, field.type) | raw }}</td>
                </tr>
              {% endfor %}
            {% endfor %}
            </tbody>
          </table>

          <hr />
        {% endif %}

        {% if model.sections | length %}
          <h2>Sections to be imported</h2>
          <table class="data fullwidth">
            <thead>
              <tr>
                <th>Section/Entry Type</th>
                <th>Type</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
            {% for key, section in model.sections %}
              <tr>
                <th>{{ key }}</th>
                <td>{{ section.type }}</td>
                <td>{{ craft.Stagecraft.SectionStatus(key, section.type) | raw }}</td>
                </tr>
                {% for ckey, contenttype in section.entryTypes %}
                  <tr>
                    <td>&nbsp;&nbsp;{{ ckey }}</td>
                    <td>Entry Type</td>
                    <td>{{ craft.Stagecraft.EntryTypeStatus(key, ckey) | raw }}</td>
                  </tr>
                  {% for tkey, tab in contenttype.fieldLayout.tabs %}
                    <tr>
                      <td>&nbsp;&nbsp;&nbsp;&nbsp;{{ tkey }}</td>
                      <td>Tab</td>
                      <td>{{ craft.Stagecraft.EntryTypeTabStatus(key, ckey, tkey) | raw }}</td>
                    </tr>
                    {% for fkey, field in tab %}
                      <tr>
                        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ fkey }}</td>
                        <td>Field</td>
                        <td>{{ craft.Stagecraft.TabFieldStatus(key, ckey, tkey, fkey) | raw }}</td>
                      </tr>
                    {% endfor %}
                  {% endfor %}
                {% endfor %}
            {% endfor %}
            </tbody>
          </table>

          <hr />
        {% endif %}

        <input type="hidden" name="data" id="importData" value='{{ rawdata|replace({"\n":'', "\r":''}) }}' />
        <input type="hidden" name="applyTo" id="applyTo" value='' />

        <div class="buttons">
          <input type="submit" class="btn submit" id="step3Submit" value="Import" />
        </div>

      </form>
    </div>
  </div>


{% endblock %}
